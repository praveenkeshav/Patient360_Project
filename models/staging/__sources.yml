version: 2

sources:
  - name: ehr
    database: pv360
    schema: raw
    description: Raw EHR and claims data for the Patient 360 project.
    config:
      freshness:
        warn_after: {count: 5, period: day}
        error_after: {count: 7, period: day}
      loaded_at_field: load_ts
      
    tables:
      - name: patients_raw
        description: Patient demographic and registry information.
        columns:
          - name: patient_id
            description: Unique identifier for each patient.
            data_tests:
              - unique
              - not_null
          - name: date_of_birth
            description: Date of birth of the patient.
            data_tests:
              - not_null
          - name: sex
            description: Gender of the patient.
            data_tests:
              - accepted_values:
                  arguments:
                    values: ['male', 'female']
          - name: load_ts
            description: Timestamp when the record was loaded into the raw table.
            data_tests:
              - not_null
      - name: encounters_raw
        description: Patient encounter information including visit dates and types.
        columns:
          - name: encounter_id
            description: Unique identifier for each encounter.
            data_tests:
              - unique
              - not_null
          - name: patient_id
            description: Unique identifier for each patient.
            data_tests:
              - not_null
              - relationships:
                  arguments:
                    to: ref('stg_patients')
                    field: patient_id
          - name: admit_datetime
            description: Date and time when the patient was admitted.
            data_tests:
              - not_null
          - name: discharge_datetime
            description: Date and time when the patient was discharged.
            data_tests:
              - not_null    
          - name: encounter_type
            description: Type of encounter (e.g., inpatient, outpatient).
            data_tests:
              - accepted_values:
                  arguments:
                    values: ['INPATIENT', 'OUTPATIENT', 'ER', 'OBSERVATION']
          - name: discharge_disposition
            description: Discharge disposition of the patient.
            data_tests:
              - not_null
              - accepted_values:
                  arguments:
                    values: ['HOME', 'SNF', 'AMA', 'REHAB', 'EXPIRED']          
          - name: load_ts
            description: Timestamp when the record was loaded into the raw table.
            data_tests:
              - not_null

      - name: lab_raw
        description: Raw lab results data including test names, values, and dates.
        columns:
          - name: load_ts
            description: Timestamp when the record was loaded into the raw table.
            data_tests:
              - not_null
          - name: data
            data_type: variant
            description: Full JSON payload
            data_tests:
              - not_null         